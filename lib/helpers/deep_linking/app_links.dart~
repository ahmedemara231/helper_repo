import 'dart:async';
import 'dart:developer';

import 'package:app_links/app_links.dart';

abstract interface class DeepLinkingService{
  FutureOr<void> init();
  Future<void> handleLinkStates();
  void printLink(Uri link){
    log(link.path.toString());
  }
}

class AppLinksImpl extends DeepLinkingService{
  late final AppLinks appLinks;
  final FutureOr<void> Function(Uri link) onOpenLink;
  AppLinksImpl({required this.onOpenLink});

  @override
  FutureOr<void> init()async{
    appLinks = AppLinks();
  }

  @override
  Future<void> handleLinkStates()async{
    await init();
    final Uri? result = await appLinks.getInitialLink();
    if(result != null){
      onOpenLink(result);
      printLink(result);
    }
    appLinks.uriLinkStream.listen((event) {
      onOpenLink(event);
      printLink(event);
    });
  }
}